import{I as O,H,u as K,a8 as X,m as J,d as V,K as Q,e as h,q as _,s as C,v as W,x as Y,r as d,o as I,k,i as n,b as v,z as p,t as w,g as e,a as r,c as x,n as Z,h as N}from"./main.2cb7c090.js";import{u as ee}from"./mail-driver.006ae7a0.js";const oe={class:"flex justify-between w-full"},te={key:0,action:""},ae={class:"px-8 py-8 sm:p-6"},re={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},le={key:1},se={class:"my-6 mx-4 border border-gray-200 relative"},ne=p(" Edit "),ie=["src"],ue={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},ve={emits:["update"],setup(de,{emit:U}){const u=O(),q=H(),P=K(),j=X();ee();const{t:c}=J();let i=V(!1);const M=V(""),f=V(!1),z=V(["customer","customerCustom","invoice","invoiceCustom","company"]),a=Q({id:null,from:null,to:null,cc:null,subject:"New Invoice",body:null}),D=h(()=>u.active&&u.componentName==="SendInvoiceModal"),G=h(()=>u.title),b=h(()=>u.data),F={from:{required:_.withMessage(c("validation.required"),C),email:_.withMessage(c("validation.email_incorrect"),W)},to:{required:_.withMessage(c("validation.required"),C)},subject:{required:_.withMessage(c("validation.required"),C)},body:{required:_.withMessage(c("validation.required"),C)}},t=Y(F,h(()=>a));function L(){f.value=!1}async function R(){let s=await q.fetchBasicMailConfig();a.id=u.id,s.data&&(a.from=s.data.from_mail),b.value&&(a.to=b.value.customer.email,(b.value.customer.cc!==null||b.value.customer.cc!=="")&&(a.cc=b.value.customer.cc)),a.body=q.selectedCompanySettings.invoice_mail_body}async function S(){if(t.value.$touch(),t.value.$invalid)return!0;try{if(i.value=!0,!f.value){const m=await j.previewInvoice(a);i.value=!1,f.value=!0;var s=new Blob([m.data],{type:"text/html"});M.value=URL.createObjectURL(s);return}const o=await j.sendInvoice(a);if(i.value=!1,o.data.success)return U("update",u.id),y(),!0}catch(o){console.error(o),i.value=!1,P.showNotification({type:"error",message:c("invoices.something_went_wrong")})}}function y(){u.closeModal(),setTimeout(()=>{t.value.$reset(),f.value=!1,M.value=null},300)}return(s,o)=>{const m=d("BaseIcon"),B=d("BaseInput"),$=d("BaseInputGroup"),T=d("BaseCustomInput"),A=d("BaseInputGrid"),g=d("BaseButton"),E=d("BaseModal");return I(),k(E,{show:e(D),onClose:y,onOpen:R},{header:n(()=>[v("div",oe,[p(w(e(G))+" ",1),r(m,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:y})])]),default:n(()=>[f.value?(I(),x("div",le,[v("div",se,[r(g,{class:"absolute top-4 right-4",disabled:e(i),variant:"primary-outline",onClick:L},{default:n(()=>[r(m,{name:"PencilIcon",class:"h-5 mr-2"}),ne]),_:1},8,["disabled"]),v("iframe",{src:M.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,ie)]),v("div",ue,[r(g,{class:"mr-3",variant:"primary-outline",type:"button",onClick:y},{default:n(()=>[p(w(s.$t("general.cancel")),1)]),_:1}),r(g,{loading:e(i),disabled:e(i),variant:"primary",type:"button",onClick:o[9]||(o[9]=l=>S())},{default:n(()=>[e(i)?N("",!0):(I(),k(m,{key:0,name:"PaperAirplaneIcon",class:"h-5 mr-2"})),p(" "+w(s.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(I(),x("form",te,[v("div",ae,[r(A,{layout:"one-column",class:"col-span-7"},{default:n(()=>[r($,{label:s.$t("general.from"),required:"",error:e(t).from.$error&&e(t).from.$errors[0].$message},{default:n(()=>[r(B,{modelValue:e(a).from,"onUpdate:modelValue":o[0]||(o[0]=l=>e(a).from=l),type:"text",invalid:e(t).from.$error,onInput:o[1]||(o[1]=l=>e(t).from.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),r($,{label:s.$t("general.to"),required:"",error:e(t).to.$error&&e(t).to.$errors[0].$message},{default:n(()=>[r(B,{modelValue:e(a).to,"onUpdate:modelValue":o[2]||(o[2]=l=>e(a).to=l),type:"text",invalid:e(t).to.$error,onInput:o[3]||(o[3]=l=>e(t).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),r($,{label:s.$t("general.cc")},{default:n(()=>[r(B,{modelValue:e(a).cc,"onUpdate:modelValue":o[4]||(o[4]=l=>e(a).cc=l),type:"text",invalid:e(t).to.$error,onInput:o[5]||(o[5]=l=>e(t).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label"]),r($,{error:e(t).subject.$error&&e(t).subject.$errors[0].$message,label:s.$t("general.subject"),required:""},{default:n(()=>[r(B,{modelValue:e(a).subject,"onUpdate:modelValue":o[6]||(o[6]=l=>e(a).subject=l),type:"text",invalid:e(t).subject.$error,onInput:o[7]||(o[7]=l=>e(t).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["error","label"]),r($,{label:s.$t("general.body"),error:e(t).body.$error&&e(t).body.$errors[0].$message,required:""},{default:n(()=>[r(T,{modelValue:e(a).body,"onUpdate:modelValue":o[8]||(o[8]=l=>e(a).body=l),fields:z.value},null,8,["modelValue","fields"])]),_:1},8,["label","error"])]),_:1})]),v("div",re,[r(g,{class:"mr-3",variant:"primary-outline",type:"button",onClick:y},{default:n(()=>[p(w(s.$t("general.cancel")),1)]),_:1}),r(g,{loading:e(i),disabled:e(i),variant:"primary",type:"button",class:"mr-3",onClick:S},{left:n(l=>[e(i)?N("",!0):(I(),k(m,{key:0,class:Z(l.class),name:"PhotographIcon"},null,8,["class"]))]),default:n(()=>[p(" "+w(s.$t("general.preview")),1)]),_:1},8,["loading","disabled"])])]))]),_:1},8,["show"])}}};export{ve as _};
