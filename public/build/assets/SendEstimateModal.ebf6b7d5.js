import{I as T,ac as H,u as K,H as X,m as J,d as I,K as Q,e as M,q as p,s as V,v as x,x as W,r as d,o as w,k,i as n,b as v,z as f,t as B,g as e,a as o,c as E,h as N}from"./main.2cb7c090.js";import{u as Y}from"./mail-driver.006ae7a0.js";const Z={class:"flex justify-between w-full"},ee={key:0,action:""},te={class:"px-8 py-8 sm:p-6"},ae={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},oe={key:1},le={class:"my-6 mx-4 border border-gray-200 relative"},re=f(" Edit "),se=["src"],ne={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},me={emits:["update"],setup(ie,{emit:U}){const m=T(),q=H(),P=K(),j=X();Y();const{t:u}=J(),i=I(!1),C=I(""),b=I(!1),D=I(["customer","customerCustom","estimate","estimateCustom","company"]);let a=Q({id:null,from:null,to:null,cc:null,subject:"New Estimate",body:null});const G=M(()=>m.active&&m.componentName==="SendEstimateModal"),y=M(()=>m.data),z={from:{required:p.withMessage(u("validation.required"),V),email:p.withMessage(u("validation.email_incorrect"),x)},to:{required:p.withMessage(u("validation.required"),V),email:p.withMessage(u("validation.email_incorrect"),x)},subject:{required:p.withMessage(u("validation.required"),V)},body:{required:p.withMessage(u("validation.required"),V)}},l=W(z,M(()=>a));function F(){b.value=!1}async function L(){let r=await j.fetchBasicMailConfig();a.id=m.id,r.data&&(a.from=r.data.from_mail),y.value&&(a.to=y.value.customer.email,(y.value.customer.cc!==null||y.value.customer.cc!=="")&&(a.cc=y.value.customer.cc)),a.body=j.selectedCompanySettings.estimate_mail_body}async function S(){if(l.value.$touch(),l.value.$invalid)return!0;try{if(i.value=!0,!b.value){const c=await q.previewEstimate(a);i.value=!1,b.value=!0;var r=new Blob([c.data],{type:"text/html"});C.value=URL.createObjectURL(r);return}const t=await q.sendEstimate(a);if(i.value=!1,t.data.success)return U("update"),g(),!0}catch(t){console.error(t),i.value=!1,P.showNotification({type:"error",message:u("estimates.something_went_wrong")})}}function g(){m.closeModal(),setTimeout(()=>{l.value.$reset(),b.value=!1,C.value=null},300)}return(r,t)=>{const c=d("BaseIcon"),h=d("BaseInput"),$=d("BaseInputGroup"),R=d("BaseCustomInput"),A=d("BaseInputGrid"),_=d("BaseButton"),O=d("BaseModal");return w(),k(O,{show:e(G),onClose:g,onOpen:L},{header:n(()=>[v("div",Z,[f(B(e(m).title)+" ",1),o(c,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:g})])]),default:n(()=>[b.value?(w(),E("div",oe,[v("div",le,[o(_,{class:"absolute top-4 right-4",disabled:i.value,variant:"primary-outline",onClick:F},{default:n(()=>[o(c,{name:"PencilIcon",class:"h-5 mr-2"}),re]),_:1},8,["disabled"]),v("iframe",{src:C.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,se)]),v("div",ne,[o(_,{class:"mr-3",variant:"primary-outline",type:"button",onClick:g},{default:n(()=>[f(B(r.$t("general.cancel")),1)]),_:1}),o(_,{loading:i.value,disabled:i.value,variant:"primary",type:"button",onClick:S},{default:n(()=>[i.value?N("",!0):(w(),k(c,{key:0,name:"PaperAirplaneIcon",class:"mr-2"})),f(" "+B(r.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(w(),E("form",ee,[v("div",te,[o(A,{layout:"one-column"},{default:n(()=>[o($,{label:r.$t("general.from"),required:"",error:e(l).from.$error&&e(l).from.$errors[0].$message},{default:n(()=>[o(h,{modelValue:e(a).from,"onUpdate:modelValue":t[0]||(t[0]=s=>e(a).from=s),type:"text",invalid:e(l).from.$error,onInput:t[1]||(t[1]=s=>e(l).from.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),o($,{label:r.$t("general.to"),required:"",error:e(l).to.$error&&e(l).to.$errors[0].$message},{default:n(()=>[o(h,{modelValue:e(a).to,"onUpdate:modelValue":t[2]||(t[2]=s=>e(a).to=s),type:"text",invalid:e(l).to.$error,onInput:t[3]||(t[3]=s=>e(l).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),o($,{label:r.$t("general.cc")},{default:n(()=>[o(h,{modelValue:e(a).cc,"onUpdate:modelValue":t[4]||(t[4]=s=>e(a).cc=s),type:"text",invalid:e(l).to.$error,onInput:t[5]||(t[5]=s=>e(l).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label"]),o($,{label:r.$t("general.subject"),required:"",error:e(l).subject.$error&&e(l).subject.$errors[0].$message},{default:n(()=>[o(h,{modelValue:e(a).subject,"onUpdate:modelValue":t[6]||(t[6]=s=>e(a).subject=s),type:"text",invalid:e(l).subject.$error,onInput:t[7]||(t[7]=s=>e(l).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),o($,{label:r.$t("general.body"),required:""},{default:n(()=>[o(R,{modelValue:e(a).body,"onUpdate:modelValue":t[8]||(t[8]=s=>e(a).body=s),fields:D.value},null,8,["modelValue","fields"])]),_:1},8,["label"])]),_:1})]),v("div",ae,[o(_,{class:"mr-3",variant:"primary-outline",type:"button",onClick:g},{default:n(()=>[f(B(r.$t("general.cancel")),1)]),_:1}),o(_,{loading:i.value,disabled:i.value,variant:"primary",type:"button",class:"mr-3",onClick:S},{default:n(()=>[i.value?N("",!0):(w(),k(c,{key:0,name:"PhotographIcon",class:"h-5 mr-2"})),f(" "+B(r.$t("general.preview")),1)]),_:1},8,["loading","disabled"])])]))]),_:1},8,["show"])}}};export{me as _};
